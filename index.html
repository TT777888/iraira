<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>みんなのイライラボタン</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="stylesheet" href="stylesheet.css">
</head>
<body>
  <div class="container">
    <h1>みんなの <span class="highlight">イライラ</span> ボタン</h1>

    <div class="status">
      <p>累計: <span id="totalCount">0</span> 回</p>
      <p>あなたの今日: <span id="todayCount">0</span> 回</p>
    </div>

    <!-- 器 -->
    <div class="vessel-wrap" aria-hidden="true">
      <svg class="vessel" viewBox="0 0 200 140">
        <ellipse cx="100" cy="130" rx="70" ry="8" class="v-shadow"></ellipse>
        <path class="v-body"
          d="M20,40 Q100,20 180,40 Q170,95 100,120 Q30,95 20,40 Z" />
        <path class="v-rim" d="M22,42 Q100,24 178,42" />
      </svg>
    </div>

    <div class="buttons">
      <button id="irairaButton" class="btn btn-pink">イライラ!!</button>
      <button id="calmButton" class="btn btn-blue">イライラしない</button>
    </div>

    <p class="note">※ 0.1 秒に 1 回だけ反応します</p>
  </div>

  <script>
    const totalCountEl = document.getElementById("totalCount");
    const todayCountEl = document.getElementById("todayCount");
    const irairaBtn = document.getElementById("irairaButton");
    const calmBtn = document.getElementById("calmButton");
    const vessel = document.querySelector(".vessel");

    const TOTAL_KEY = "iraira_total";
    const TODAY_KEY = "iraira_today_" + new Date().toISOString().slice(0,10);
    const VESSEL_KEY = "iraira_vessel_scale";

    let total = Number(localStorage.getItem(TOTAL_KEY) || 0);
    let today = Number(localStorage.getItem(TODAY_KEY) || 0);
    let vesselScale = Number(localStorage.getItem(VESSEL_KEY) || 1);

    const updateCounters = () => {
      totalCountEl.textContent = total;
      todayCountEl.textContent = today;
    };
    updateCounters();

    const applyVesselScale = () => {
      vessel.style.setProperty("--v-scale", vesselScale);
      try { localStorage.setItem(VESSEL_KEY, vesselScale); } catch {}
    };
    applyVesselScale();

    let cooldown = false;
    const withCooldown = (fn) => {
      if (cooldown) return;
      cooldown = true;
      setTimeout(() => (cooldown = false), 100); // 0.1秒
      fn();
    };

    const pulse = (el, cls="pressed", ms=200) => {
      el.classList.add(cls);
      setTimeout(() => el.classList.remove(cls), ms);
    };

    // イライラ → 器が小さくなる
    irairaBtn.addEventListener("click", () => withCooldown(() => {
      total++; today++;
      updateCounters();
      try {
        localStorage.setItem(TOTAL_KEY, total);
        localStorage.setItem(TODAY_KEY, today);
      } catch {}
      vesselScale -= 0.1; // 縮小
      applyVesselScale();
      pulse(irairaBtn);
      pulse(vessel, "vessel-bounce", 240);
    }));

    // イライラしない → 器が大きくなる
    calmBtn.addEventListener("click", () => withCooldown(() => {
      vesselScale += 0.1; // 拡大
      applyVesselScale();
      pulse(calmBtn);
      pulse(vessel, "vessel-bounce", 240);
    }));
  </script>
</body>
</html>
